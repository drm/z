# Version Control System settings
vcs:
    # The SVN url to the project. Currently, only SVN is supported
    url:            ~

    export:
        # The revision info file to write when exporting
        revfile:    .z.rev


tasks:
    # Clean the build
    _clean:         rm -rf $(build.dir)

    # Export the specified version to the build dir
    _vcs.export:
        unless: build.version == versionof(build.dir)
        do:
            - @_clean
            - $(printf("Exporting version <comment>%s</comment> to <comment>%s</comment>\n", build.version, build.dir))
            - svn export $(!verbose ? "-q") $(vcs.url)/$(build.version) $(build.dir)
            - svn info $(vcs.url)/$(build.version) > $(build.dir)/$(vcs.export.revfile)
        yield:      build.dir

    # Create a version branch
    v.branch:
        set:
            branch:     ?
            _tgt:       $(vcs.url)/branches/$(branch)
            _src:       ? $(vcs.url)/$(vcs.current)
        do:
            - svn cp $(_src) $(_tgt) -m"Created branch '$(branch)'"

    # Create a version tag
    v.tag:
        set:
            tag:        ?
            _tgt:       $(vcs.url)/tags/$(tag)
            _src:       ? $(vcs.url)/$(vcs.current)

        do:
            - svn cp $(_src) $(_tgt) -m"Created tag '$(tag)'"

    # List all versions
    v.versions:
        do:
            - svn ls $(vcs.url)/tags     | awk '{print "tags/" $1}'
            - svn ls $(vcs.url)/branches | awk '{print "branches/" $1}'

    # Diff to specific version
    v.diff:
        set:
            version:   ?
        do:
            - svn diff --summarize $(vcs.url)/$(version) $(vcs.url)/$(vcs..current)

