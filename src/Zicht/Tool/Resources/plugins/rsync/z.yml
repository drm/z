# Synchronization options
sync:
    # Command line options to rsync
    options:        -rpcL --delete

    # File containing exclusion rules for rsync
    exclude_file:   "rsync.exclude"

tasks:
    # Synchronize the build dir to the remote environment
    _sync: |
        rsync \
            $(sync.options) \
                $(sync.exclude_file ? sprintf("--exclude-from=%s/%s", tasks.build, sync.exclude_file)) \
                -v \
            $(tasks.build)/ $(envs[target_env].ssh):$(envs[target_env].root) \
        ;

    # Synchronize the build dir to the remote environment
    _sync_simulate: |
        rsync \
            --dry-run \
            $(sync.options) \
                $(sync.exclude_file ? sprintf("--exclude-from=%s/%s", tasks.build, sync.exclude_file)) \
                -v \
            $(tasks.build)/ $(envs[target_env].ssh):$(envs[target_env].root) \
        ;
