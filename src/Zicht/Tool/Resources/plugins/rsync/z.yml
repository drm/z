# Synchronization options
sync:
    # Command line options to rsync
    options:        -rupvcL --delete

    # File containing exclusion rules for rsync
    exclude_file:   "rsync.exclude"

tasks:
    # Synchronize the build dir to the remote environment
    _sync: |
        rsync \
            --exclude-from=$(tasks.build)/$(sync.exclude_file) \
            $(sync.options) $(if(sync.exclude_file, sprintf("--exclude-from=%s/%s", tasks.build, sync.exclude_file))) \
            $(tasks.build)/ $(env.ssh):$(env.root) \
        ;

    # Synchronize the build dir to the remote environment
    _sync.simulate: |
        rsync \
            --dry-run \
            $(sync.options) $(if(sync.exclude_file, sprintf("--exclude-from=%s/%s", tasks.build, sync.exclude_file))) \
            $(tasks.build)/ $(env.ssh):$(env.root) \
        ;
