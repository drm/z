chmod:
    defaults:
        dir: 755
        file: 644

    executable: []
    writable: []

tasks:
    chmod.apply:
        set:
            chmod.dir: ?
        do:
            - find $(chmod.dir) -type d -exec chmod $(chmod.defaults.dir) '{}' +
            - find $(chmod.dir) -type f -exec chmod $(chmod.defaults.file) '{}' +
            - ?(chmod.writable)     chmod -R 777 $(verbose ? "-c ") $(chmod.writable)
            - ?(chmod.executable)   chmod -R 755 $(verbose ? "-c ") $(chmod.executable)

    _chmod.prepare_build:
        set:
            chmod.dir: build.dir
        do: [@chmod.apply]

    build:
        post: [@_chmod.prepare_build]
