symfony:
    web:     web
    console: 'app/console'

tasks:
    _symfony.build.copy_local_vendor: |
        if [ -d "$(cwd)/vendor/" ];
            then rsync -rp $(cwd)/vendor/ $(build.dir)/vendor;
        fi;

    _symfony.build.composer_install: |
        if [ -f "$(build.dir)/composer.lock" ];
            then cd $(build.dir) && composer install --no-scripts;
        fi;

    _symfony.build.assets_install: |
        if [ -f "$(build.dir)/$(symfony.console)" ];
            then cd $(build.dir) && php $(symfony.console) assets:install $(symfony.web) --env=$(env) --no-debug;
        fi;

    _symfony.build.assetic_dump: |
        if [ -f "$(build.dir)/$(symfony.console)" ];
            then cd $(build.dir) && php $(symfony.console) assetic:dump --env=$(env) --no-debug;
        fi;

    build:
        do:
            - @_symfony.build.copy_local_vendor
            - @_symfony.build.composer_install
            - @_symfony.build.assets_install
            - @_symfony.build.assetic_dump

    deploy: ssh $(env.ssh) "cd $(env.root) && php $(symfony.console) cache:clear --env=$(env) --no-debug"
